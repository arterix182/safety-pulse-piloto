<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b1220"/>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" href="assets/logo.svg"/>
  <title>Safety Pulse</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand" role="button" tabindex="0" id="brandBtn" title="Inicio">
        <img class="brandLogo" src="assets/logo.svg" alt="Logo"/>
        <div class="brandText">
          <div class="brandName">Safety Pulse</div>
          <div class="brandSub" id="brandSub">Offline ‚Ä¢ GitHub Pages</div>
        </div>
      </div>
      <div class="topActions">
        <button class="ghost" id="exportBtn" title="Exportar CSV" aria-label="Exportar">Exportar</button>
        <button class="ghost" id="logoutBtn" title="Salir" aria-label="Salir">Salir</button>
      </div>
    </header>

    <main class="main">
      <!-- View: Welcome -->
      <section class="view active" id="viewWelcome">
        <div class="center">
          <div class="splash">
            <img src="assets/logo.svg" class="splashLogo" alt=""/>
            <div class="splashGlow"></div>
          </div>
          <h1>Seguridad, sin fricci√≥n.</h1>
          <p>Registra recorridos e interacciones. Todo queda asociado a tu usuario.</p>
          <button class="primary big" id="goLogin">Entrar</button>
          <div class="hint" id="hintDir">Directorio: cargando‚Ä¶</div>
        </div>
      </section>

      <!-- View: Login -->
      <section class="view" id="viewLogin">
        <div class="card">
          <h2>Login (GMIN)</h2>
          <p class="muted">Ingresa tu GMIN. Se validar√° contra el directorio local.</p>
          <label class="field">
            <span>GMIN</span>
            <input id="gminInput" inputmode="numeric" autocomplete="off" placeholder="Ej. 123456"/>
          </label>
          <button class="primary" id="loginBtn">Continuar</button>
          <div class="msg" id="loginMsg"></div>
          <button class="ghost full" id="backWelcome">Volver</button>
        </div>
      </section>

      <!-- View: Home -->
      <section class="view" id="viewHome">
        <div class="hero">
          <div class="heroLeft">
            <div class="badge" id="userBadge">‚Äî</div>
            <h2 id="hello">Hola</h2>
            <p class="muted" id="userMeta">‚Äî</p>
          </div>
          <div class="heroRight">
            <div class="kpi">
              <div class="kpiNum" id="kpiRec">0</div>
              <div class="kpiLbl">Recorridos</div>
            </div>
            <div class="kpi">
              <div class="kpiNum" id="kpiInt">0</div>
              <div class="kpiLbl">Interacciones</div>
            </div>
          </div>
        </div>

        <div class="grid">
          <button class="tile" data-go="recorrido">
            <div class="tileIcon">üõ°Ô∏è</div>
            <div class="tileText">
              <div class="tileTitle">Recorrido</div>
              <div class="tileSub">Actos / Condiciones</div>
            </div>
          </button>

          <button class="tile" data-go="interaccion">
            <div class="tileIcon">ü§ù</div>
            <div class="tileText">
              <div class="tileTitle">Interacciones</div>
              <div class="tileSub">Conversaci√≥n y hallazgos</div>
            </div>
          </button>

          <button class="tile" data-go="dashboard">
            <div class="tileIcon">üìà</div>
            <div class="tileText">
              <div class="tileTitle">Dashboard</div>
              <div class="tileSub">KPIs (local piloto)</div>
            </div>
          </button>

          <button class="tile" data-go="manual">
            <div class="tileIcon">üìò</div>
            <div class="tileText">
              <div class="tileTitle">Manual</div>
              <div class="tileSub">Uso r√°pido</div>
            </div>
          </button>
        </div>

        <div class="fabWrap">
          <button class="fab" id="quickRecord" title="Registrar r√°pido">
            <span class="fabPlus">Ôºã</span> Registrar
          </button>
        </div>
      </section>

      <!-- View: Form (shared) -->
      <section class="view" id="viewForm">
        <div class="card wide">
          <div class="formHeader">
            <h2 id="formTitle">Registro</h2>
            <div class="pill" id="formTypePill">‚Äî</div>
          </div>

          <div class="row2">
            <label class="field">
              <span>GMIN auditado</span>
              <input id="auditedGmin" inputmode="numeric" placeholder="GMIN auditado"/>
            </label>
            <div class="field read">
              <span>Fecha / Hora</span>
              <div class="readonly" id="autoDate">‚Äî</div>
            </div>
          </div>

          <div class="row2">
            <div class="field read">
              <span>Nombre auditado</span>
              <div class="readonly" id="auditedName">‚Äî</div>
            </div>
            <div class="field read">
              <span>√Årea (Plant)</span>
              <div class="readonly" id="auditedPlant">‚Äî</div>
            </div>
          </div>

          <div class="row2">
            <div class="field read">
              <span>Antig√ºedad</span>
              <div class="readonly" id="auditedLos">‚Äî</div>
            </div>
            <div class="field read">
              <span>Manager</span>
              <div class="readonly" id="auditedMgr">‚Äî</div>
            </div>
          </div>

          <label class="field">
            <span>Acto inseguro</span>
            <input id="actoInput" placeholder="Buscar‚Ä¶"/>
            <div class="combo" id="actoCombo"></div>
          </label>

          <label class="field">
            <span>Condici√≥n insegura</span>
            <input id="condInput" placeholder="Buscar‚Ä¶"/>
            <div class="combo" id="condCombo"></div>
          </label>

          <label class="field">
            <span>Comentario (opcional)</span>
            <textarea id="commentInput" rows="3" placeholder="Describe brevemente‚Ä¶"></textarea>
          </label>

          <div class="actions">
            <button class="ghost" id="formBack">Volver</button>
            <button class="primary" id="saveBtn">Guardar</button>
            <button class="ghost" id="saveNewBtn">Guardar + Nuevo</button>
          </div>

          <div class="msg" id="saveMsg"></div>
        </div>
      </section>

      <!-- View: Dashboard -->
      <section class="view" id="viewDashboard">
        <div class="card wide">
          <h2>Dashboard (Piloto local)</h2>
          <p class="muted">Este piloto resume lo capturado en este dispositivo. En fase 2 lo hacemos global.</p>

          <div class="row3">
            <div class="kpi bigkpi">
              <div class="kpiNum" id="dbTotal">0</div>
              <div class="kpiLbl">Registros totales</div>
            </div>
            <div class="kpi bigkpi">
              <div class="kpiNum" id="dbActoTop">‚Äî</div>
              <div class="kpiLbl">Acto m√°s com√∫n</div>
            </div>
            <div class="kpi bigkpi">
              <div class="kpiNum" id="dbCondTop">‚Äî</div>
              <div class="kpiLbl">Condici√≥n m√°s com√∫n</div>
            </div>
          </div>

          <div class="list" id="recentList"></div>

          <div class="actions">
            <button class="ghost" id="dashBack">Volver</button>
            <button class="danger" id="wipeBtn">Borrar datos del piloto</button>
          </div>
          <div class="msg" id="wipeMsg"></div>
        </div>
      </section>

      <!-- View: Manual -->
      <section class="view" id="viewManual">
        <div class="card wide">
          <h2>Manual r√°pido</h2>
          <ol class="steps">
            <li>Entra con tu <b>GMIN</b>. La app te identifica desde el directorio.</li>
            <li>Registra <b>Recorrido</b> o <b>Interacci√≥n</b>.</li>
            <li>Ingresa el <b>GMIN auditado</b> para autollenar nombre/plant/antig√ºedad/manager.</li>
            <li>Selecciona <b>Acto</b> y <b>Condici√≥n</b> (buscables).</li>
            <li>Guarda. El registro queda asociado a tu usuario autom√°ticamente.</li>
            <li>Exporta CSV cuando lo necesites.</li>
          </ol>
          <div class="actions">
            <button class="ghost" id="manualBack">Volver</button>
          </div>
        </div>
      </section>
    </main>

    <footer class="bottombar" id="bottombar">
      <button class="navbtn active" data-nav="home">Inicio</button>
      <button class="navbtn" data-nav="recorrido">Recorrido</button>
      <button class="navbtn" data-nav="interaccion">Interacciones</button>
      <button class="navbtn" data-nav="dashboard">Dashboard</button>
      <button class="navbtn" data-nav="manual">Manual</button>
    </footer>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
